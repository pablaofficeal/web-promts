<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º—Ç–æ–≤ –±–µ–∑ –∫–æ–¥–∞</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="container">
    <h1>üöÄ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–º—Ç–æ–≤ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</h1>

    <div class="form-group">
      <label for="technology">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:</label>
      <select id="technology" onchange="loadFrameworks()">
        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é --</option>
      </select>
    </div>

    <div class="form-group">
      <label for="framework">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ / –§—Ä–µ–π–º–≤–æ—Ä–∫:</label>
      <select id="framework" onchange="loadLanguages()">
        <option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é --</option>
      </select>
    </div>

    <div class="form-group">
      <label for="language">–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
      <select id="language">
        <option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ --</option>
      </select>
    </div>

    <button onclick="generatePrompt()" class="btn">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º—Ç</button>

    <div id="result" class="result"></div>
  </div>

  <script>
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    document.addEventListener('DOMContentLoaded', () => {
      fetch('/api/technologies')
        .then(res => res.json())
        .then(technologies => {
          const techSelect = document.getElementById('technology');
          technologies.forEach(tech => {
            const option = document.createElement('option');
            option.value = tech.id;
            option.textContent = tech.name;
            techSelect.appendChild(option);
          });
        })
        .catch(err => showError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"));
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫ –ø–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
    function loadFrameworks() {
      const tech = document.getElementById('technology').value;
      const frameworkSelect = document.getElementById('framework');
      const languageSelect = document.getElementById('language');
      
      frameworkSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>';
      languageSelect.innerHTML = '<option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ --</option>';

      if (!tech) return;

      fetch(`/api/frameworks/${tech}`)
        .then(res => res.json())
        .then(frameworks => {
          frameworks.forEach(fw => {
            const option = document.createElement('option');
            option.value = fw.id;
            option.textContent = fw.name;
            frameworkSelect.appendChild(option);
          });
        })
        .catch(err => showError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏"));
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —è–∑—ã–∫–æ–≤ –ø–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—É
    function loadLanguages() {
      const tech = document.getElementById('technology').value;
      const framework = document.getElementById('framework').value;
      const languageSelect = document.getElementById('language');
      
      languageSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>';

      if (!tech || !framework) return;

      fetch(`/api/languages/${tech}/${framework}`)
        .then(res => res.json())
        .then(languages => {
          languages.forEach(lang => {
            const option = document.createElement('option');
            option.value = lang;
            option.textContent = capitalize(lang);
            languageSelect.appendChild(option);
          });
        })
        .catch(err => showError("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —è–∑—ã–∫–∏"));
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º—Ç–∞
    function generatePrompt() {
      const tech = document.getElementById('technology').value;
      const framework = document.getElementById('framework').value;
      const language = document.getElementById('language').value;
      const resultDiv = document.getElementById('result');

      if (!tech || !framework || !language) {
        showError("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é, —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –∏ —è–∑—ã–∫");
        return;
      }

      resultDiv.innerHTML = '<p>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...</p>';

      fetch('/api/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ technology: tech, framework: framework, language: language })
      })
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            showError(data.error);
          } else {
            resultDiv.innerHTML = `
              <h3>–í–∞—à –ø—Ä–æ–º—Ç:</h3>
              <textarea rows="6" class="prompt-box">${data.prompt}</textarea>
              <button onclick="copyToClipboard()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            `;
          }
        })
        .catch(err => showError("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"));
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä
    function copyToClipboard() {
      const textarea = document.querySelector('.prompt-box');
      textarea.select();
      document.execCommand('copy');
      alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä!');
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function showError(msg) {
      document.getElementById('result').innerHTML = `<p class="error">${msg}</p>`;
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }
  </script>
</body>
</html>